**Цель домашнего задания**

Научиться связывать ORM-модели и повысить уровень знаний по созданию запросов к БД с помощью ORM.

**Что нужно сделать**

Давайте продолжим работу с нашей библиотекой из предыдущего домашнего задания.
Список таблиц для решения задачи лежит в файле **materials/db.sql**.

**Задачи**

1) Проведите доработку моделей:
    * добавьте к моделям связи и внешние ключи
    * опишите каскадное поведение
    * опишите способы подгрузки данных - используйте различные типы жадной подгрузки
    * Связь MANY-TO-MANY для таблиц students - receiving_books - books
     реализуйте с помощью AssociationProxy
2) Добавьте роуты во flask-приложение:
    * получить кол-во оставшихся в библиотеке книг по автору (GET
     -входной параметр - ID автора)
    * получить список книг, которые студент не читал, при этом другие книги этого автора студент уже брал  (GET - входной параметр - ID студента). Пример: Я брал книгу Льва Толстого “Война и мир”, роут должен вернуть другие произведения этого автора, которые есть в библиотеке
    * получить среднее кол-во книг, которые студенты брали в этом месяце (GET)
    * получить самую популярную книгу среди студентов, у которых средний балл больше 4.0 (GET)
    * получить ТОП-10 самых читающих студентов в этом году (GET)
3) Создайте роут, который будет принимать csv-файл с данными по студентам (разделитель ;). Используя csv.DictReader (https://docs.python.org/3/library/csv.html#csv.DictReader), обработайте файл и используйте Session.bulk_insert_mappings() для массовой вставки студентов.
4) **По желанию**. Создайте триггер на событие перед вставкой в таблицу students. Триггер должен проверять, что номер телефона имеет формат +7(9**) -*** - ** - **, где * - цифра от 0 до 9.

**Что оценивается**

Умение:
* связывать таблицы с помощью ORM; 
* понимание каскадного поведения;
* понимание подгрузки данных; 
* работать со сложными запросами (group_by, order_by, subquery, func);
* работать с массовой вставкой
* создание orm events


**Как отправить задание на проверку**

Выполните домашнее задание в GitLab, в форме ниже напишите «Сделано» и нажмите кнопку «Отправить».


